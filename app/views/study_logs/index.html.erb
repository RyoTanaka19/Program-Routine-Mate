<% content_for(:title, t('.title')) %>

<div class="flex items-center justify-center mb-8 space-x-4">
  <%= link_to 'AI', new_suggest_path, class: "px-3 py-3 bg-blue-500 text-white font-semibold rounded-full hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-300 text-sm" %>

<%= link_to study_reminders_path, class: 'inline-flex items-center gap-2 px-5 py-2.5 bg-blue-500 text-white text-sm font-semibold rounded-lg shadow hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-300 transition-all' do %>
  <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ -->
  <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
  </svg>
  å­¦ç¿’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
<% end %>

</div>




<% if current_user %>
  <div class="text-center mb-4">
    <%= link_to image_tag("icon.png", class: "w-16 h-16 rounded-full shadow-md hover:shadow-lg transition"), user_badges_path(current_user) %>
  </div>
<% end %>

<br>

<%= render 'search_form', q: @q, url: study_logs_path %>


<br>

<!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
<div class="flex flex-col items-center mb-6">
  <%= link_to image_tag("crown.png", class: "w-16 h-16 rounded-full shadow-md hover:shadow-lg transition"), ranking_study_logs_path %>

  <div class="flex space-x-4 mt-4 overflow-x-auto">
    <% @ranking.each_with_index do |ranking, index| %>
      <% user = User.find(ranking[:user_id]) %>
      <div class="flex flex-col items-center bg-gray-50 p-4 rounded-lg shadow-md hover:bg-gray-200 w-24">
        <div class="text-center bg-yellow-200 font-semibold w-12 h-12 flex items-center justify-center rounded-full">
          <%= index + 1 %>
        </div>
        <div class="mt-2 text-center font-medium">
          <%= user.name %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<%= link_to 'ã‚¸ãƒ£ãƒ³ãƒ«ä¸€è¦§', study_genres_path %>


<br>

<div class="w-full flex lg:items-center flex-col">
  <div id="cal-heatmap" class="overflow-auto md:overflow-scroll"></div>
</div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/cal-heatmap/dist/cal-heatmap.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/cal-heatmap/dist/cal-heatmap.css">

<script>
  // ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã‚’ã‚»ãƒƒãƒˆã™ã‚‹é–¢æ•°ã‚’ç›´ã¡ã«å®Ÿè¡Œ
  set_heatmap(); 

  function set_heatmap() {
    let startDate = new Date();
    startDate.setMonth(startDate.getMonth() - 2); // 2ãƒ¶æœˆå‰ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ
    console.log(startDate);
    let data = <%= @study_logs_for_js.to_json.html_safe %>; // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§æ¸¡ã•ã‚ŒãŸstudy_logsãƒ‡ãƒ¼ã‚¿

    // ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ã‚’æ•´ãˆã€ISOå½¢å¼ã®æ—¥ä»˜ã«å¤‰æ›ã™ã‚‹
data = data.map(item => ({
  date: new Date(item.date).toISOString(),
  total: item.total
}));

const cal = new CalHeatmap();
cal.paint({
  itemSelector: '#cal-heatmap',
  domain: {
    type: 'month',
    gutter: 4,
    label: { text: 'MMM', textAlign: 'start', position: 'top' },
  },
  subDomain: {
    type: 'ghDay',
    radius: 2,
    width: 11,
    height: 11,
    gutter: 4,
  },
  date: { start: startDate },
  range: 12,
  data: { source: data, x: 'date', y: 'total' },
  type: 'json',
  scale: {
    color: {
      type: 'linear',
      range: ['#ff4d4d', '#a8e6a2', '#6abf4f', '#337d2b', '#175e17'],
      domain: [0, 0.1, 1, 2, 3], // 0 â†’ èµ¤ã€0.1ä»¥ä¸Š â†’ ç·‘ç³»
    },
  },
});
  }
</script>

<!-- æŠ•ç¨¿ä¸€è¦§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
<div class="flex flex-wrap gap-4 justify-center">
  <% @study_logs.each do |study_log| %>
    <div class="w-80 mb-4">
      <div class="border p-4 rounded-lg shadow-md hover:bg-gray-100">
      <!-- æŠ•ç¨¿è€…ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ -->
      <div class="flex items-center mb-4">
  <%= link_to user_path(study_log.user), class: "flex items-center" do  %>
    <%= image_tag(study_log.user.profile_image? ? study_log.user.profile_image_url : "default_study_logs_image.png", class: "w-16 h-16 rounded-full object-cover mr-4") %>
    <p class="font-semibold text-gray-700"><%= study_log.user&.name || "ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãªã—" %></p>
  <% end %>
</div>


     <p><strong>å­¦ç¿’æ™‚é–“ï¼š</strong><%= study_log.total.present? ? "#{study_log.total} åˆ†" : "æœªè¨­å®š" %></p>

        <!-- æŠ•ç¨¿æ—¥æ™‚ -->
        <p><strong>æŠ•ç¨¿æ—¥:</strong> <%= study_log.created_at.strftime("%Yå¹´%mæœˆ%dæ—¥ %H:%M") %></p>

        <!-- å­¦ç¿’å†…å®¹ -->
        <p class="mt-2">å­¦ç¿’å†…å®¹: <%= link_to study_log.content, study_log_path(study_log), class: "text-blue-500 hover:underline" %></p>

        <!-- æŠ•ç¨¿ç”»åƒ -->
        <div class="mt-2">
          <%= image_tag(study_log.image? ? study_log.image_url : "default_study_logs_image.png", class: "w-full h-auto rounded-md") %>
        </div>

        <!-- æ„Ÿæƒ³ -->
        <p class="mt-2">æ„Ÿæƒ³ãªã©: <%= study_log.text %></p>

        <br>

        <p><strong>ã‚¸ãƒ£ãƒ³ãƒ«:</strong>
        <% if study_log.study_genre.present? %>
          <%= study_log.study_genre.name %>
        <% else %>
          æœªè¨­å®š
        <% end %>

        <!-- ã„ã„ã­ã®æ•° -->
        <div class="flex items-center gap-2 text-gray-700 text-lg mt-2">
          <span class="text-xl">ğŸ‘</span>
          <span><%= study_log.likes.count %></span>
        </div>

      </p>
        <!-- ãƒ­ã‚°ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
        <div class="login-status mb-4">
          <% if user_signed_in? && current_user == study_log.user %>
            <span style="color: green;">âœ… ãƒ­ã‚°ã‚¤ãƒ³ä¸­</span>
          <% else %>
            <span style="color: red;">âŒ æœªãƒ­ã‚°ã‚¤ãƒ³</span>
          <% end %>
        </div>

        <!-- ç·¨é›†ã¨å‰Šé™¤ãƒœã‚¿ãƒ³ -->
        <% if user_signed_in? && study_log.user_id == current_user.id %>
          <div class="flex justify-between mt-4">
            <!-- ç·¨é›†ãƒœã‚¿ãƒ³ -->
            <%= link_to edit_study_log_path(study_log), id: "button-edit-#{study_log.id}", class: "inline-flex items-center px-4 py-2 bg-blue-500 text-white font-semibold rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-300" do %>
              <i class="fas fa-pencil-alt w-4 h-4 mr-2"></i> ç·¨é›†
            <% end %>

            <!-- å‰Šé™¤ãƒœã‚¿ãƒ³ -->
            <%= link_to study_log_path(study_log), data: { turbo_method: :delete, turbo_confirm: "æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹?" }, id: "button-delete-#{study_log.id}", class: "inline-flex items-center px-4 py-2 bg-red-500 text-white font-semibold rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-300" do %>
              <i class="fas fa-trash w-4 h-4 mr-2"></i> å‰Šé™¤
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
<%= paginate @study_logs %>

