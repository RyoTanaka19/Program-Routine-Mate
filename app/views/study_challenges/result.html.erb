<h1 class="text-2xl font-bold mb-6 text-green-600 text-center">AIによる採点結果</h1>

<%# ✅ 正誤判定表示 %>
<% if @user_answer.present? && @correct_answer.present? %>
  <% if @user_answer == @correct_answer %>
    <div class="mb-6 text-center text-green-600 font-bold text-xl">
      ✅ 正解です！
    </div>
  <% else %>
    <div class="mb-6 text-center text-red-600 font-bold text-xl">
      ❌ 不正解です...
    </div>
  <% end %>
<% end %>

<%# ✅ 得点と正答率（例：1点/1問） %>
<% if @score.present? && @total.present? %>
  <% correct_rate = ((@score.to_f / @total) * 100).round(1) %>
<div class="mb-6 text-center">
  <h2 class="text-lg font-semibold text-gray-800 mb-2">今回の得点</h2>
  <p class="text-2xl font-bold text-green-600"><%= @score %> 点 / <%= @total %> 点</p>
  <p class="text-sm mt-1">
    正答率：
    <span class="
      font-semibold
      <% if correct_rate == 100.0 %>
        glow-animation text-green-600
      <% elsif correct_rate >= 80 %>
        text-green-600
      <% elsif correct_rate >= 50 %>
        text-yellow-500
      <% else %>
        text-red-600
      <% end %>
    "><%= correct_rate %>%</span>
  </p>
</div>
<% end %>

<%# 以下は問題文などの表示は変わらず %>

<div class="mb-4 text-center">
  <h2 class="text-xl font-semibold text-green-600 mb-2">問題</h2>
  <pre class="bg-green-50 p-4 rounded inline-block text-left whitespace-pre-wrap break-words font-mono leading-relaxed max-w-full mx-auto">
<%= @study_challenge.user_response.gsub(/^正解:.*$/, "").strip %>
  </pre>
</div>

<div class="mb-6 text-center">
  <h2 class="text-xl font-semibold <%= @user_answer == @correct_answer ? 'text-green-600' : 'text-red-600' %>">
    あなたの回答
    <% if @user_answer.present? && @correct_answer.present? %>
      <span class="ml-2 text-2xl">
        <%= @user_answer == @correct_answer ? "⭕️" : "❌" %>
      </span>
    <% end %>
  </h2>
  <p class="text-lg font-semibold <%= @user_answer == @correct_answer ? 'text-green-600' : 'text-red-600' %>">
    <%= @user_answer %>
  </p>
</div>

<div class="mb-6 text-center animate-fade-in">
  <h2 class="text-xl font-semibold text-green-600 mb-2 flex justify-center items-center gap-2">
    <i class="fas fa-lightbulb text-yellow-400"></i>
    解説
  </h2>

  <p class="text-sm sm:text-base leading-relaxed text-gray-700 bg-green-50 border border-gray-200 rounded px-4 sm:px-6 py-4 inline-block text-left max-w-xl mx-auto shadow-md">
    <%= @explanation %>
  </p>
</div>

<div class="text-center flex justify-center gap-4">
  <%= form_with url: study_log_study_challenges_path(@study_log), method: :post do %>
    <%= submit_tag "別の問題に挑戦する",
        data: { action: "click->loading#show" },
        class: "mt-4 inline-block bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded transition" %>
  <% end %>

  <%= link_to "学習記録一覧へ", study_logs_path,
      data: { action: "click->loading#show" },
      class: "mt-4 inline-block bg-blue-500 hover:bg-gray-600 text-white px-4 py-2 rounded transition" %>
</div>


